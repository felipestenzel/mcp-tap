# Handoff — v0.6.0 native HTTP/SSE config + agent instruction improvements

- **Date**: 2026-02-22 03:00
- **Branch**: main (tudo merged)
- **Versão atual**: v0.6.0 no PyPI e npm
- **Testes**: 1230 passando

---

## O que foi feito nessa sessão

### PRs mergeados (em ordem)

| PR | O que fez |
|----|-----------|
| #50 | Smithery field guidance nas instruções (`source`, `use_count`, `verified`); fechou issue smithery-integration; deletou handoff anterior |
| #51 | Bump v0.5.1 |
| #52 | Seção "When to use mcp-tap" — gatilhos explícitos para invocar o agente automaticamente |
| #53 | Bump v0.5.2 |
| #54 | Desambiguação do nome: "NOT a network proxy, traffic inspector, or protocol debugger" |
| #55 | Bump v0.5.3 |
| #56 | Suporte inicial streamable-HTTP via mcp-remote bridge |
| #57 | Bump v0.5.4 |
| #58 | **Feature principal**: suporte nativo HTTP/SSE com detecção de capacidade por cliente |
| #59 | Bump v0.6.0 |

### Feature principal do v0.6.0 (PR #58)

Arquivos novos/alterados:
- `models.py` — `HttpServerConfig`, `HTTP_NATIVE_CLIENTS`
- `config/reader.py` — parse de entradas HTTP nativas existentes
- `config/detection.py` — `client_supports_http_native()`
- `config/writer.py` — aceita `ServerConfig | HttpServerConfig`
- `connection/base.py` — `HttpReachabilityPort` Protocol
- `connection/tester.py` — `HttpReachabilityChecker` (HEAD request, 401=reachable)
- `server.py` — `http_reachability` no AppContext
- `tools/configure.py` — fluxo HTTP completo: capability → native config → reachability → write
- `tools/list.py` — output com `url` para HTTP servers
- `tools/health.py` — usa reachability para HTTP servers
- `lockfile/writer.py` — suporte a `HttpServerConfig`
- `tests/test_http_reachability.py` — novo arquivo, 13 testes
- 51 novos testes total (1179 → 1230)

---

## O que fazer na próxima sessão

### 1. Teste real do v0.6.0 (PRIORITÁRIO)

No projeto `stz_profile` (ou qualquer outro):

```bash
claude mcp remove mcp-tap
claude mcp add mcp-tap -- uvx mcp-tap@0.6.0
```

Reiniciar o Claude Code e testar:

```
instala o Vercel MCP
```

**O que deve acontecer:**
- `configure_server("vercel-mcp", "https://mcp.vercel.com", registry_type="npm")`
- Log: "HTTP server detected — checking reachability..."
- HEAD `https://mcp.vercel.com` → 401 (OAuth) → `validation_passed: true`
- Config escrita: `{"type": "http", "url": "https://mcp.vercel.com"}`
- Mensagem: "Server configured. Restart your MCP client... On first use you may need to authenticate via browser (OAuth)."

**O que NÃO deve acontecer:**
- `npm install https://mcp.vercel.com` → E401 error
- nenhum `mcp-remote` para Claude Code

### 2. Validar campos Smithery nas recomendações

Testar se o LLM menciona `verified` e `use_count` ao recomendar servidores. Prompt:
```
busca servidores mcp para postgres
```

Se o agente não mencionar "verified by Smithery" ou `use_count` como sinal de popularidade, as instruções podem precisar de ajuste adicional.

### 3. Atualizar MEMORY.md

Versão ainda registrada como 0.5.0 — já atualizada nesta sessão para 0.6.0.

### 4. Possível melhoria: `scan_project` retorna `registry_type: "npm"` para servidores HTTP

O scan retornou `registry_type: "npm"` para o Vercel MCP mesmo sendo `transport: "streamable-http"`. O `_is_http_transport` detecta pelo `package_identifier` (URL), então funciona. Mas seria mais correto o scan retornar `registry_type: "streamable-http"` para esses servidores. Baixa prioridade.

### 5. Possível melhoria: scan detecta que mcp-tap está desatualizado

Quando o usuário tem v0.5.x rodando e tenta instalar um servidor HTTP, o agente deveria detectar que a versão é antiga e avisar para reiniciar. Médio prioridade.

---

## Estado dos arquivos

- `main` — v0.6.0, 1230 testes, limpo
- `docs/handoff/` — só este arquivo + `_TEMPLATE.md`
- Issues abertas: `docs/issues/2026-02-21_http-native-config.md` (marcar como done)
- Issues fechadas: `docs/issues/2026-02-21_smithery-integration.md` (done)

---

## Prompt para retomar

> Sessão anterior implementou v0.6.0 com suporte nativo a servidores HTTP/SSE (Vercel MCP, Figma MCP etc) sem mcp-remote. Leia o handoff em `docs/handoff/2026-02-22_0300_v060-http-native.md`. Execute o teste real descrito no item 1: reinicie o Claude Code no projeto `stz_profile`, instale `mcp-tap@0.6.0` e teste "instala o Vercel MCP". Verifique se a config `{"type":"http","url":"..."}` é escrita corretamente, sem tentar npm install na URL.
